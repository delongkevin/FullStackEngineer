<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texas Hold'em Poker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a5c36, #0d7745);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            width: 100%;
        }

        h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }

        .player-info, .pot-info, .phase-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .pot-amount {
            font-size: 1.8rem;
            font-weight: bold;
            color: gold;
        }

        .phase-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffcc00;
        }

        .table-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #0a5c36;
            border-radius: 50%;
            border: 15px solid #8B4513;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .community-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            color: black;
            font-weight: bold;
            position: relative;
        }

        .card.red {
            color: #d40000;
        }

        .card-back {
            background: linear-gradient(45deg, #1a5fb4, #3584e4);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
        }

        .card-top, .card-bottom {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .card-bottom {
            transform: rotate(180deg);
        }

        .card-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
        }

        .players-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .player {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            transition: all 0.3s;
            position: relative;
        }

        .player.active {
            background: rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px gold;
        }

        .player.dealer::before {
            content: "D";
            position: absolute;
            top: -10px;
            right: -10px;
            background: gold;
            color: black;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .player.small-blind::before {
            content: "SB";
            position: absolute;
            top: -10px;
            left: -10px;
            background: #4CAF50;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.7rem;
        }

        .player.big-blind::before {
            content: "BB";
            position: absolute;
            top: -10px;
            left: -10px;
            background: #F44336;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.7rem;
        }

        .player-cards {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }

        .player-cards .card {
            width: 60px;
            height: 90px;
            font-size: 0.8rem;
        }

        .player-name {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .player-stack {
            color: gold;
            font-weight: bold;
        }

        .player-bet {
            margin-top: 5px;
            color: #ffcc00;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .fold {
            background: #ff4d4d;
            color: white;
        }

        .check {
            background: #4CAF50;
            color: white;
        }

        .call {
            background: #2196F3;
            color: white;
        }

        .raise {
            background: #FF9800;
            color: white;
        }

        .all-in {
            background: #9C27B0;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .action-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .betting-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .chip-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        .chip:hover {
            transform: scale(1.1);
        }

        .chip-1 {
            background: white;
            color: black;
            border: 2px solid #ccc;
        }

        .chip-5 {
            background: red;
            border: 2px solid #a00;
        }

        .chip-25 {
            background: green;
            border: 2px solid #060;
        }

        .chip-100 {
            background: black;
            border: 2px solid #333;
        }

        .chip-500 {
            background: purple;
            border: 2px solid #505;
        }

        .bet-amount {
            font-size: 1.5rem;
            font-weight: bold;
            color: gold;
            margin: 10px 0;
        }

        .slider-container {
            width: 100%;
            margin: 10px 0;
        }

        input[type="range"] {
            width: 100%;
        }

        .game-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
            width: 100%;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hand-ranking {
            position: absolute;
            bottom: -25px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .players-container {
                flex-direction: column;
                align-items: center;
            }
            
            .player {
                width: 100%;
                max-width: 300px;
            }
            
            .table-container {
                height: 300px;
            }
            
            .card {
                width: 60px;
                height: 90px;
            }
            
            .player-cards .card {
                width: 50px;
                height: 75px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Texas Hold'em Poker</h1>
            <p>Follows official poker rules with proper betting rounds</p>
        </header>

        <div class="game-info">
            <div class="player-info">
                <div>Player: <span id="player-name">You</span></div>
                <div>Stack: $<span id="player-stack">1500</span></div>
                <div>Current Bet: $<span id="player-current-bet">0</span></div>
            </div>
            <div class="pot-info">
                <div>Pot</div>
                <div class="pot-amount">$<span id="pot-amount">0</span></div>
            </div>
            <div class="phase-info">
                <div>Game Phase</div>
                <div class="phase-display" id="phase-display">Pre-flop</div>
            </div>
        </div>

        <div class="table-container">
            <div class="community-cards" id="community-cards">
                <!-- Community cards will be inserted here -->
            </div>
        </div>

        <div class="players-container">
            <!-- Player positions will be inserted here -->
        </div>

        <div class="controls">
            <button class="action-btn fold" id="fold-btn">Fold</button>
            <button class="action-btn check" id="check-btn">Check</button>
            <button class="action-btn call" id="call-btn">Call $0</button>
            <button class="action-btn raise" id="raise-btn">Raise</button>
            <button class="action-btn all-in" id="allin-btn">All In</button>
        </div>

        <div class="betting-controls">
            <div class="chip-selector">
                <div class="chip chip-1" data-value="1">$1</div>
                <div class="chip chip-5" data-value="5">$5</div>
                <div class="chip chip-25" data-value="25">$25</div>
                <div class="chip chip-100" data-value="100">$100</div>
                <div class="chip chip-500" data-value="500">$500</div>
            </div>
            <div class="slider-container">
                <input type="range" id="bet-slider" min="0" max="1500" value="0" step="5">
            </div>
            <div class="bet-amount">Bet: $<span id="bet-amount">0</span></div>
            <button class="action-btn" id="place-bet-btn" style="background: #FF5722;">Place Bet</button>
        </div>

        <div class="game-log">
            <h3>Game Log</h3>
            <div id="log-entries">
                <div class="log-entry">Welcome to Texas Hold'em Poker!</div>
                <div class="log-entry">Game started. Blinds posted.</div>
            </div>
        </div>
    </div>

    <script>
        // Game state with proper poker rules
        const gameState = {
            players: [
                { id: 1, name: "You", stack: 1500, bet: 0, cards: [], isActive: true, isFolded: false, isAllIn: false, position: 0 },
                { id: 2, name: "Player 2", stack: 1500, bet: 0, cards: [], isActive: false, isFolded: false, isAllIn: false, position: 1 },
                { id: 3, name: "Player 3", stack: 1500, bet: 0, cards: [], isActive: false, isFolded: false, isAllIn: false, position: 2 },
                { id: 4, name: "Player 4", stack: 1500, bet: 0, cards: [], isActive: false, isFolded: false, isAllIn: false, position: 3 }
            ],
            communityCards: [],
            pot: 0,
            currentBet: 0,
            currentPlayerIndex: 0,
            dealerPosition: 0,
            smallBlindPosition: 1,
            bigBlindPosition: 2,
            smallBlindAmount: 10,
            bigBlindAmount: 20,
            gamePhase: 'preflop', // preflop, flop, turn, river, showdown
            betAmount: 0,
            lastRaiseAmount: 0,
            bettingRoundComplete: false,
            deck: [],
            actionRequired: false
        };

        // Card deck
        const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

        // Hand rankings
        const handRankings = {
            'high-card': 1,
            'pair': 2,
            'two-pair': 3,
            'three-of-a-kind': 4,
            'straight': 5,
            'flush': 6,
            'full-house': 7,
            'four-of-a-kind': 8,
            'straight-flush': 9,
            'royal-flush': 10
        };

        // Initialize the game
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            setupEventListeners();
            startNewHand();
        });

        function initializeGame() {
            // Create player elements
            const playersContainer = document.querySelector('.players-container');
            playersContainer.innerHTML = '';
            
            gameState.players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = `player ${player.isActive ? 'active' : ''}`;
                playerEl.id = `player-${player.id}`;
                
                playerEl.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-stack">$${player.stack}</div>
                    <div class="player-cards">
                        <div class="card card-back"></div>
                        <div class="card card-back"></div>
                    </div>
                    <div class="player-bet">Bet: $${player.bet}</div>
                `;
                
                playersContainer.appendChild(playerEl);
            });
        }

        function setupEventListeners() {
            // Chip selection
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    gameState.betAmount += value;
                    updateBetControls();
                });
            });

            // Bet slider
            document.getElementById('bet-slider').addEventListener('input', function() {
                gameState.betAmount = parseInt(this.value);
                updateBetControls();
            });

            // Place bet button
            document.getElementById('place-bet-btn').addEventListener('click', function() {
                placeBet();
            });

            // Action buttons
            document.getElementById('fold-btn').addEventListener('click', function() {
                fold();
            });

            document.getElementById('check-btn').addEventListener('click', function() {
                check();
            });

            document.getElementById('call-btn').addEventListener('click', function() {
                call();
            });

            document.getElementById('raise-btn').addEventListener('click', function() {
                raise();
            });

            document.getElementById('allin-btn').addEventListener('click', function() {
                allIn();
            });
        }

        function startNewHand() {
            // Reset game state for new hand
            gameState.communityCards = [];
            gameState.pot = 0;
            gameState.currentBet = 0;
            gameState.betAmount = 0;
            gameState.lastRaiseAmount = 0;
            gameState.bettingRoundComplete = false;
            gameState.actionRequired = false;
            
            // Reset player states
            gameState.players.forEach(player => {
                player.bet = 0;
                player.cards = [];
                player.isFolded = false;
                player.isAllIn = false;
                player.isActive = false;
            });
            
            // Move dealer button
            gameState.dealerPosition = (gameState.dealerPosition + 1) % gameState.players.length;
            gameState.smallBlindPosition = (gameState.dealerPosition + 1) % gameState.players.length;
            gameState.bigBlindPosition = (gameState.dealerPosition + 2) % gameState.players.length;
            
            // Post blinds
            const smallBlindPlayer = gameState.players[gameState.smallBlindPosition];
            const bigBlindPlayer = gameState.players[gameState.bigBlindPosition];
            
            const smallBlindBet = Math.min(gameState.smallBlindAmount, smallBlindPlayer.stack);
            const bigBlindBet = Math.min(gameState.bigBlindAmount, bigBlindPlayer.stack);
            
            smallBlindPlayer.bet = smallBlindBet;
            smallBlindPlayer.stack -= smallBlindBet;
            
            bigBlindPlayer.bet = bigBlindBet;
            bigBlindPlayer.stack -= bigBlindBet;
            
            gameState.pot = smallBlindBet + bigBlindBet;
            gameState.currentBet = bigBlindBet;
            
            // Create and shuffle deck
            gameState.deck = createDeck();
            shuffleDeck(gameState.deck);
            
            // Deal cards
            dealCards();
            
            // Set first active player (after big blind)
            gameState.currentPlayerIndex = (gameState.bigBlindPosition + 1) % gameState.players.length;
            gameState.players[gameState.currentPlayerIndex].isActive = true;
            
            // Update UI
            updateUI();
            updatePlayerPositions();
            
            // Add log entries
            addLogEntry(`New hand started. Dealer: ${gameState.players[gameState.dealerPosition].name}`);
            addLogEntry(`Small blind: ${smallBlindPlayer.name} posts $${smallBlindBet}`);
            addLogEntry(`Big blind: ${bigBlindPlayer.name} posts $${bigBlindBet}`);
            
            // If it's the human player's turn, enable controls
            if (gameState.currentPlayerIndex === 0) {
                enablePlayerControls();
            } else {
                // AI player's turn
                simulateAIPlayer();
            }
        }

        function createDeck() {
            const deck = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    deck.push({
                        rank: rank,
                        suit: suit,
                        isRed: suit === 'hearts' || suit === 'diamonds'
                    });
                }
            }
            return deck;
        }

        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function dealCards() {
            // Deal two cards to each player
            for (let i = 0; i < 2; i++) {
                for (const player of gameState.players) {
                    if (player.stack > 0) { // Only deal to players with chips
                        player.cards.push(gameState.deck.pop());
                    }
                }
            }
            
            // Update player card displays
            updatePlayerCards();
        }

        function updatePlayerCards() {
            gameState.players.forEach(player => {
                const playerEl = document.getElementById(`player-${player.id}`);
                const cardsContainer = playerEl.querySelector('.player-cards');
                cardsContainer.innerHTML = '';
                
                player.cards.forEach(card => {
                    const cardEl = document.createElement('div');
                    
                    if (player.id === 1 || gameState.gamePhase === 'showdown') {
                        // Show player's own cards or all cards at showdown
                        cardEl.className = `card ${card.isRed ? 'red' : ''}`;
                        cardEl.innerHTML = `
                            <div class="card-top">
                                <div>${card.rank}</div>
                                <div>${getSuitSymbol(card.suit)}</div>
                            </div>
                            <div class="card-center">${getSuitSymbol(card.suit)}</div>
                            <div class="card-bottom">
                                <div>${card.rank}</div>
                                <div>${getSuitSymbol(card.suit)}</div>
                            </div>
                        `;
                    } else {
                        // Face down card for opponents
                        cardEl.className = 'card card-back';
                        cardEl.textContent = 'POKER';
                    }
                    
                    cardsContainer.appendChild(cardEl);
                });
                
                // Show hand ranking at showdown
                if (gameState.gamePhase === 'showdown' && !player.isFolded) {
                    const handRank = evaluateHand(player.cards, gameState.communityCards);
                    const handRankEl = document.createElement('div');
                    handRankEl.className = 'hand-ranking';
                    handRankEl.textContent = handRank.name;
                    cardsContainer.appendChild(handRankEl);
                }
            });
        }

        function getSuitSymbol(suit) {
            switch(suit) {
                case 'hearts': return '♥';
                case 'diamonds': return '♦';
                case 'clubs': return '♣';
                case 'spades': return '♠';
                default: return '';
            }
        }

        function updateUI() {
            // Update player info
            document.getElementById('player-stack').textContent = gameState.players[0].stack;
            document.getElementById('player-current-bet').textContent = gameState.players[0].bet;
            
            // Update pot
            document.getElementById('pot-amount').textContent = gameState.pot;
            
            // Update phase
            document.getElementById('phase-display').textContent = gameState.gamePhase.charAt(0).toUpperCase() + gameState.gamePhase.slice(1);
            
            // Update player active states
            gameState.players.forEach((player, index) => {
                const playerEl = document.getElementById(`player-${player.id}`);
                if (player.isActive) {
                    playerEl.classList.add('active');
                } else {
                    playerEl.classList.remove('active');
                }
                
                // Update player bet display
                playerEl.querySelector('.player-bet').textContent = `Bet: $${player.bet}`;
                playerEl.querySelector('.player-stack').textContent = `$${player.stack}`;
                
                // Update folded state
                if (player.isFolded) {
                    playerEl.style.opacity = '0.6';
                } else {
                    playerEl.style.opacity = '1';
                }
            });
            
            // Update call button text
            const callAmount = gameState.currentBet - gameState.players[0].bet;
            document.getElementById('call-btn').textContent = `Call $${callAmount > 0 ? callAmount : 0}`;
            
            // Update community cards
            updateCommunityCards();
            
            // Update bet controls
            updateBetControls();
        }

        function updatePlayerPositions() {
            gameState.players.forEach(player => {
                const playerEl = document.getElementById(`player-${player.id}`);
                playerEl.classList.remove('dealer', 'small-blind', 'big-blind');
                
                if (player.position === gameState.dealerPosition) {
                    playerEl.classList.add('dealer');
                } else if (player.position === gameState.smallBlindPosition) {
                    playerEl.classList.add('small-blind');
                } else if (player.position === gameState.bigBlindPosition) {
                    playerEl.classList.add('big-blind');
                }
            });
        }

        function updateCommunityCards() {
            const communityCardsEl = document.getElementById('community-cards');
            communityCardsEl.innerHTML = '';
            
            // Show actual community cards based on game phase
            const cardsToShow = {
                'preflop': 0,
                'flop': 3,
                'turn': 4,
                'river': 5,
                'showdown': 5
            }[gameState.gamePhase] || 0;
            
            for (let i = 0; i < cardsToShow; i++) {
                const card = gameState.communityCards[i];
                const cardEl = document.createElement('div');
                cardEl.className = `card ${card.isRed ? 'red' : ''}`;
                cardEl.innerHTML = `
                    <div class="card-top">
                        <div>${card.rank}</div>
                        <div>${getSuitSymbol(card.suit)}</div>
                    </div>
                    <div class="card-center">${getSuitSymbol(card.suit)}</div>
                    <div class="card-bottom">
                        <div>${card.rank}</div>
                        <div>${getSuitSymbol(card.suit)}</div>
                    </div>
                `;
                communityCardsEl.appendChild(cardEl);
            }
            
            // Add placeholder cards for remaining community cards
            for (let i = cardsToShow; i < 5; i++) {
                const cardEl = document.createElement('div');
                cardEl.className = 'card card-back';
                cardEl.textContent = 'POKER';
                communityCardsEl.appendChild(cardEl);
            }
        }

        function updateBetControls() {
            document.getElementById('bet-amount').textContent = gameState.betAmount;
            document.getElementById('bet-slider').value = gameState.betAmount;
            
            // Update slider max based on player stack
            const maxBet = gameState.players[0].stack;
            document.getElementById('bet-slider').max = maxBet;
            
            // Set minimum raise amount
            const minRaise = gameState.currentBet + (gameState.lastRaiseAmount || gameState.bigBlindAmount);
            if (gameState.betAmount < minRaise && gameState.betAmount < maxBet) {
                gameState.betAmount = minRaise;
                document.getElementById('bet-amount').textContent = gameState.betAmount;
                document.getElementById('bet-slider').value = gameState.betAmount;
            }
        }

        function placeBet() {
            if (gameState.betAmount <= 0) return;
            
            const player = gameState.players[0];
            const actualBet = Math.min(gameState.betAmount, player.stack);
            const totalBet = player.bet + actualBet;
            
            // Check if this is a raise
            if (totalBet > gameState.currentBet) {
                gameState.lastRaiseAmount = totalBet - gameState.currentBet;
                gameState.currentBet = totalBet;
            }
            
            player.bet = totalBet;
            player.stack -= actualBet;
            gameState.pot += actualBet;
            
            addLogEntry(`${player.name} bets $${actualBet}`);
            
            // Reset bet amount
            gameState.betAmount = 0;
            updateBetControls();
            updateUI();
            
            // Move to next player
            nextPlayer();
        }

        function fold() {
            const player = gameState.players[0];
            player.isFolded = true;
            player.isActive = false;
            
            addLogEntry(`${player.name} folds`);
            
            // Move to next player
            nextPlayer();
        }

        function check() {
            const player = gameState.players[0];
            
            // Verify that checking is allowed (current bet is matched)
            if (player.bet < gameState.currentBet) {
                addLogEntry("Cannot check - you must call or fold");
                return;
            }
            
            addLogEntry(`${player.name} checks`);
            
            // Move to next player
            nextPlayer();
        }

        function call() {
            const player = gameState.players[0];
            const callAmount = gameState.currentBet - player.bet;
            
            if (callAmount <= 0) {
                check();
                return;
            }
            
            const actualCall = Math.min(callAmount, player.stack);
            
            player.bet += actualCall;
            player.stack -= actualCall;
            gameState.pot += actualCall;
            
            addLogEntry(`${player.name} calls $${actualCall}`);
            
            updateUI();
            
            // Move to next player
            nextPlayer();
        }

        function raise() {
            // Set bet amount to minimum raise
            const minRaise = gameState.currentBet + (gameState.lastRaiseAmount || gameState.bigBlindAmount);
            gameState.betAmount = Math.min(minRaise, gameState.players[0].stack);
            updateBetControls();
            
            addLogEntry(`${gameState.players[0].name} raises to $${gameState.betAmount}`);
        }

        function allIn() {
            const player = gameState.players[0];
            gameState.betAmount = player.stack;
            player.isAllIn = true;
            updateBetControls();
            
            addLogEntry(`${player.name} goes all in with $${player.stack}`);
        }

        function nextPlayer() {
            // Reset current player active state
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            currentPlayer.isActive = false;
            
            // Find next active player
            let nextPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            let rounds = 0;
            
            while (rounds < gameState.players.length) {
                const player = gameState.players[nextPlayerIndex];
                
                // Skip folded players and all-in players
                if (!player.isFolded && !player.isAllIn && player.stack > 0) {
                    break;
                }
                
                nextPlayerIndex = (nextPlayerIndex + 1) % gameState.players.length;
                rounds++;
            }
            
            gameState.currentPlayerIndex = nextPlayerIndex;
            const nextPlayer = gameState.players[gameState.currentPlayerIndex];
            nextPlayer.isActive = true;
            
            updateUI();
            
            // Check if betting round is complete
            if (isBettingRoundComplete()) {
                advanceGamePhase();
            } else {
                // If it's back to the human player, enable controls
                if (gameState.currentPlayerIndex === 0) {
                    enablePlayerControls();
                } else {
                    // AI player's turn
                    simulateAIPlayer();
                }
            }
        }

        function isBettingRoundComplete() {
            // Check if all active players have matched the current bet or are all-in
            let activePlayers = 0;
            let playersMatchedBet = 0;
            
            for (const player of gameState.players) {
                if (!player.isFolded && player.stack > 0) {
                    activePlayers++;
                    
                    if (player.bet === gameState.currentBet || player.isAllIn) {
                        playersMatchedBet++;
                    }
                }
            }
            
            // Also check if we've gone full circle without a raise
            return playersMatchedBet === activePlayers;
        }

        function advanceGamePhase() {
            // Reset betting state
            gameState.currentBet = 0;
            gameState.lastRaiseAmount = 0;
            gameState.bettingRoundComplete = false;
            
            // Reset player bets for new betting round
            gameState.players.forEach(player => {
                player.bet = 0;
            });
            
            // Advance to next phase
            switch (gameState.gamePhase) {
                case 'preflop':
                    gameState.gamePhase = 'flop';
                    dealCommunityCards(3);
                    addLogEntry("*** FLOP ***");
                    break;
                case 'flop':
                    gameState.gamePhase = 'turn';
                    dealCommunityCards(1);
                    addLogEntry("*** TURN ***");
                    break;
                case 'turn':
                    gameState.gamePhase = 'river';
                    dealCommunityCards(1);
                    addLogEntry("*** RIVER ***");
                    break;
                case 'river':
                    gameState.gamePhase = 'showdown';
                    determineWinner();
                    addLogEntry("*** SHOWDOWN ***");
                    return; // Don't continue to set next player
                case 'showdown':
                    startNewHand();
                    return;
            }
            
            // Set first active player (small blind or next active player)
            let firstPlayerIndex = gameState.smallBlindPosition;
            while (gameState.players[firstPlayerIndex].isFolded || gameState.players[firstPlayerIndex].isAllIn) {
                firstPlayerIndex = (firstPlayerIndex + 1) % gameState.players.length;
            }
            
            gameState.currentPlayerIndex = firstPlayerIndex;
            gameState.players[gameState.currentPlayerIndex].isActive = true;
            
            updateUI();
            
            // If it's the human player's turn, enable controls
            if (gameState.currentPlayerIndex === 0) {
                enablePlayerControls();
            } else {
                // AI player's turn
                simulateAIPlayer();
            }
        }

        function dealCommunityCards(count) {
            for (let i = 0; i < count; i++) {
                gameState.communityCards.push(gameState.deck.pop());
            }
        }

        function determineWinner() {
            // Evaluate all active players' hands
            const activePlayers = gameState.players.filter(player => !player.isFolded);
            const playerHands = activePlayers.map(player => {
                return {
                    player: player,
                    hand: evaluateHand(player.cards, gameState.communityCards)
                };
            });
            
            // Sort by hand strength
            playerHands.sort((a, b) => b.hand.strength - a.hand.strength);
            
            // Find winner(s)
            const winningHandStrength = playerHands[0].hand.strength;
            const winners = playerHands.filter(ph => ph.hand.strength === winningHandStrength);
            
            // Award pot to winner(s)
            const prize = Math.floor(gameState.pot / winners.length);
            winners.forEach(winner => {
                winner.player.stack += prize;
                addLogEntry(`${winner.player.name} wins $${prize} with ${winner.hand.name}`);
            });
            
            // Update UI to show all cards
            updatePlayerCards();
            updateUI();
            
            // Start new hand after a delay
            setTimeout(() => {
                startNewHand();
            }, 5000);
        }

        function evaluateHand(playerCards, communityCards) {
            // Simplified hand evaluation
            // In a real implementation, this would be more complex
            const allCards = [...playerCards, ...communityCards];
            
            // Check for flush
            const suitsCount = {};
            for (const card of allCards) {
                suitsCount[card.suit] = (suitsCount[card.suit] || 0) + 1;
            }
            
            const flushSuit = Object.keys(suitsCount).find(suit => suitsCount[suit] >= 5);
            
            if (flushSuit) {
                // Check for straight flush
                const flushCards = allCards.filter(card => card.suit === flushSuit);
                const straightFlush = checkStraight(flushCards);
                
                if (straightFlush) {
                    if (straightFlush.includes('A') && straightFlush.includes('K')) {
                        return { name: 'Royal Flush', strength: handRankings['royal-flush'] };
                    }
                    return { name: 'Straight Flush', strength: handRankings['straight-flush'] };
                }
                
                return { name: 'Flush', strength: handRankings['flush'] };
            }
            
            // Check for straight
            const straight = checkStraight(allCards);
            if (straight) {
                return { name: 'Straight', strength: handRankings['straight'] };
            }
            
            // Check for other hand types (simplified)
            const rankCounts = {};
            for (const card of allCards) {
                rankCounts[card.rank] = (rankCounts[card.rank] || 0) + 1;
            }
            
            const counts = Object.values(rankCounts).sort((a, b) => b - a);
            
            if (counts[0] === 4) {
                return { name: 'Four of a Kind', strength: handRankings['four-of-a-kind'] };
            } else if (counts[0] === 3 && counts[1] >= 2) {
                return { name: 'Full House', strength: handRankings['full-house'] };
            } else if (counts[0] === 3) {
                return { name: 'Three of a Kind', strength: handRankings['three-of-a-kind'] };
            } else if (counts[0] === 2 && counts[1] === 2) {
                return { name: 'Two Pair', strength: handRankings['two-pair'] };
            } else if (counts[0] === 2) {
                return { name: 'Pair', strength: handRankings['pair'] };
            } else {
                return { name: 'High Card', strength: handRankings['high-card'] };
            }
        }

        function checkStraight(cards) {
            // Convert ranks to numerical values
            const rankValues = {
                '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, 
                '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14
            };
            
            // Get unique numerical values and sort them
            const values = [...new Set(cards.map(card => rankValues[card.rank]))].sort((a, b) => a - b);
            
            // Check for straight (including Ace-low straight A-2-3-4-5)
            for (let i = values.length - 1; i >= 4; i--) {
                if (values[i] - values[i-4] === 4) {
                    return cards.slice(i-4, i+1).map(card => card.rank);
                }
            }
            
            // Check for Ace-low straight
            if (values.includes(14) && values.includes(2) && values.includes(3) && 
                values.includes(4) && values.includes(5)) {
                return ['A', '2', '3', '4', '5'];
            }
            
            return null;
        }

        function enablePlayerControls() {
            // Enable all action buttons
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.disabled = false;
            });
            
            // Enable betting controls
            document.getElementById('place-bet-btn').disabled = false;
            document.getElementById('bet-slider').disabled = false;
            document.querySelectorAll('.chip').forEach(chip => {
                chip.style.pointerEvents = 'auto';
                chip.style.opacity = '1';
            });
        }

        function simulateAIPlayer() {
            // Disable player controls during AI turn
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            document.getElementById('place-bet-btn').disabled = true;
            document.getElementById('bet-slider').disabled = true;
            document.querySelectorAll('.chip').forEach(chip => {
                chip.style.pointerEvents = 'none';
                chip.style.opacity = '0.5';
            });
            
            // Simple AI logic based on hand strength and position
            const aiPlayer = gameState.players[gameState.currentPlayerIndex];
            const handStrength = evaluateHandStrength(aiPlayer.cards, gameState.communityCards);
            const position = aiPlayer.position;
            
            let action;
            
            // Adjust strategy based on hand strength and position
            if (handStrength > 0.8) {
                // Strong hand - raise or all-in
                if (aiPlayer.stack <= gameState.bigBlindAmount * 10) {
                    action = 'all-in';
                } else {
                    action = 'raise';
                }
            } else if (handStrength > 0.5) {
                // Medium hand - call or check
                if (gameState.currentBet > aiPlayer.bet) {
                    action = 'call';
                } else {
                    action = 'check';
                }
            } else {
                // Weak hand - fold or check
                if (gameState.currentBet > aiPlayer.bet && gameState.currentBet > aiPlayer.stack * 0.1) {
                    action = 'fold';
                } else {
                    action = 'check';
                }
            }
            
            // Execute AI action after a delay
            setTimeout(() => {
                switch(action) {
                    case 'fold':
                        aiPlayer.isFolded = true;
                        aiPlayer.isActive = false;
                        addLogEntry(`${aiPlayer.name} folds`);
                        break;
                    case 'check':
                        addLogEntry(`${aiPlayer.name} checks`);
                        break;
                    case 'call':
                        const callAmount = Math.min(gameState.currentBet - aiPlayer.bet, aiPlayer.stack);
                        aiPlayer.bet += callAmount;
                        aiPlayer.stack -= callAmount;
                        gameState.pot += callAmount;
                        addLogEntry(`${aiPlayer.name} calls $${callAmount}`);
                        break;
                    case 'raise':
                        const raiseAmount = Math.min(
                            gameState.currentBet + (gameState.lastRaiseAmount || gameState.bigBlindAmount),
                            aiPlayer.stack
                        );
                        aiPlayer.bet += raiseAmount;
                        aiPlayer.stack -= raiseAmount;
                        gameState.pot += raiseAmount;
                        gameState.currentBet = aiPlayer.bet;
                        gameState.lastRaiseAmount = raiseAmount;
                        addLogEntry(`${aiPlayer.name} raises to $${raiseAmount}`);
                        break;
                    case 'all-in':
                        const allInAmount = aiPlayer.stack;
                        aiPlayer.bet += allInAmount;
                        aiPlayer.stack = 0;
                        gameState.pot += allInAmount;
                        aiPlayer.isAllIn = true;
                        if (aiPlayer.bet > gameState.currentBet) {
                            gameState.currentBet = aiPlayer.bet;
                            gameState.lastRaiseAmount = allInAmount;
                        }
                        addLogEntry(`${aiPlayer.name} goes all in with $${allInAmount}`);
                        break;
                }
                
                updateUI();
                
                // Move to next player
                nextPlayer();
            }, 1500);
        }

        function evaluateHandStrength(playerCards, communityCards) {
            // Simplified hand strength evaluation
            // In a real implementation, this would use more sophisticated methods
            const allCards = [...playerCards, ...communityCards];
            
            // Count high cards
            const highCardRanks = ['A', 'K', 'Q', 'J', '10'];
            let highCardCount = 0;
            
            for (const card of playerCards) {
                if (highCardRanks.includes(card.rank)) {
                    highCardCount++;
                }
            }
            
            // Check for suited cards
            const isSuited = playerCards[0].suit === playerCards[1].suit;
            
            // Check for connected cards
            const rankValues = {
                '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, 
                '8': 8, '9': 9, '10': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14
            };
            
            const card1Value = rankValues[playerCards[0].rank];
            const card2Value = rankValues[playerCards[1].rank];
            const isConnected = Math.abs(card1Value - card2Value) <= 2;
            
            // Calculate hand strength (simplified)
            let strength = 0;
            
            // Base strength from high cards
            strength += highCardCount * 0.2;
            
            // Bonus for suited cards
            if (isSuited) strength += 0.1;
            
            // Bonus for connected cards
            if (isConnected) strength += 0.1;
            
            // Bonus for pocket pairs
            if (playerCards[0].rank === playerCards[1].rank) strength += 0.3;
            
            return Math.min(strength, 1);
        }

        function addLogEntry(message) {
            const logEntries = document.getElementById('log-entries');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
        }
    </script>
</body>
</html>